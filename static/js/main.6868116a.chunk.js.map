{"version":3,"sources":["Tooltip.module.css","Spinner.module.css","StoryLine.module.css","shape.ts","Tooltip.tsx","StoryLine.tsx","App.tsx","serviceWorker.js","index.tsx","App.module.css"],"names":["module","exports","metaRegex","blackList","filterGood","post","includes","url","fromGender","toGender","age","serverPostToClient","titleInt","parseInt","h","exec","createdUtc","Date","t","undefined","score","s","u","toLowerCase","title","comments","c","Tooltip","top","left","className","styles","tooltip","style","role","aria-label","href","target","rel","Storyline","React","memo","posts","containerRef","useRef","containerSize","useComponentSize","useState","setTooltip","daysMap","group","p","startOfDay","valueOf","days","Array","from","sort","a","verticalScale","scaleLinear","domain","range","height","sizeScale","storyline","timeline","map","date","timelineTick","key","toString","timelineYear","format","columns","ref","column","filter","gender","postCn","selected","tabIndex","fontSize","onFocus","e","r","getBoundingClientRect","document","documentElement","scrollLeft","width","updateMilestones","fileNames","fill","_","i","App","buffer","setBuffer","setPosts","useEffect","length","fileName","pop","axios","get","then","result","newPosts","data","shift","app","loading","stylesSpinner","heart","info","Boolean","window","location","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.6868116a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"tooltip\":\"Tooltip_tooltip__2efxb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"heart\":\"Spinner_heart__2DRhj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"storyline\":\"StoryLine_storyline__3sU0T\",\"timeline\":\"StoryLine_timeline__2g2mK\",\"timelineTick\":\"StoryLine_timelineTick__2h9IT\",\"timelineYear\":\"StoryLine_timelineYear__4cJCI\",\"columns\":\"StoryLine_columns__2xOMo\",\"column\":\"StoryLine_column__38MPb\",\"post\":\"StoryLine_post__yr64I\",\"selected\":\"StoryLine_selected__dFYa5\"};","export interface ServerPost {\n    c: number // comments\n    t: number // time\n    s: number // score\n    h: string // title\n    u: string // url\n}\n\nexport type Gender = \"m\" | \"f\" | \"r\"\n\nexport interface Post {\n    createdUtc: Date\n    score: number\n    url: string\n    age?: number\n    fromGender?: Gender\n    toGender?: Gender\n    title: string\n    comments: number\n}\n\nconst metaRegex = /\\[([m,f])4([m,f])]/gim\n\nconst blackList = [\n    \"https://www.reddit.com/r/GBr4r/comments/bavsby/18_m4f_watchet_just_a_guy_looking_for_a_girl/\",\n]\n\nexport function filterGood(post: Post) {\n    return (\n        !blackList.includes(post.url) &&\n        post.fromGender &&\n        post.toGender &&\n        post.age\n    )\n}\n\nexport function serverPostToClient(post: ServerPost): Post {\n    const titleInt = parseInt(post.h, 10)\n    const [, fromGender, toGender] = metaRegex.exec(post.h) || [\n        null,\n        null,\n        null,\n    ]\n\n    return {\n        createdUtc: new Date(post.t * 1000),\n        age: titleInt >= 14 && titleInt < 150 ? titleInt : undefined,\n        score: post.s,\n        url: post.u,\n        fromGender: fromGender\n            ? (fromGender.toLowerCase() as Gender)\n            : undefined,\n        toGender: toGender ? (toGender.toLowerCase() as Gender) : undefined,\n        title: post.h,\n        comments: post.c,\n    }\n}\n","import React from \"react\"\nimport styles from \"./Tooltip.module.css\"\n\nexport interface TooltipProps {\n    top: number\n    left: number\n    title: string\n    score: number\n    comments: number\n    url: string\n}\n\nexport const Tooltip: React.FC<TooltipProps> = ({\n    top,\n    left,\n    title,\n    score,\n    comments,\n    url,\n}) => {\n    return (\n        <div className={styles.tooltip} style={{ top, left }}>\n            <h4>{title}</h4>\n            <p>\n                <span role=\"img\" aria-label=\"post score\">\n                    ‚¨ÜÔ∏è\n                </span>{\" \"}\n                {score}\n            </p>\n            <p>\n                <span role=\"img\" aria-label=\"comments\">\n                    üí¨Ô∏è\n                </span>{\" \"}\n                {comments}\n            </p>\n            <a href={url} target=\"_blank\" rel=\"noopener noreferrer\">\n                Open the post\n            </a>\n        </div>\n    )\n}\n","import React from \"react\"\nimport { group } from \"d3-array\"\nimport startOfDay from \"date-fns/startOfDay\"\nimport format from \"date-fns/format\"\nimport { Post, Gender } from \"./shape\"\nimport { scaleLinear } from \"d3-scale\"\nimport useComponentSize from \"@rehooks/component-size\"\nimport styles from \"./StoryLine.module.css\"\nimport { Tooltip } from \"./Tooltip\"\n\nexport interface StorylineProps {\n    posts: Post[]\n}\n\nfunction getEmoji(age: number, gender: Gender) {\n    if (age < 20 && gender === \"m\") {\n        return \"üë¶\"\n    } else if (age < 20 && gender === \"f\") {\n        return \"üëß\"\n    } else if (age < 40 && gender === \"m\") {\n        return \"üë®\"\n    } else if (age < 40 && gender === \"f\") {\n        return \"üë©\"\n    } else if (age < 60 && gender === \"m\") {\n        return \"üë®‚Äçü¶≥\"\n    } else if (age < 60 && gender === \"f\") {\n        return \"üë©‚Äçü¶≥\"\n    } else if (gender === \"f\") {\n        return \"üëµ\"\n    } else if (gender === \"m\") {\n        return \"üë¥\"\n    } else {\n        return \"üëΩ\"\n    }\n}\n\ninterface Tooltip extends Post {\n    top: number\n    left: number\n}\n\nexport const Storyline: React.FC<StorylineProps> = React.memo(({ posts }) => {\n    const containerRef = React.useRef<HTMLDivElement>(null)\n    const containerSize = useComponentSize(containerRef)\n    const [tooltip, setTooltip] = React.useState<Tooltip | null>(null)\n    const daysMap = group(posts, p => startOfDay(p.createdUtc).valueOf())\n    const days = Array.from(daysMap).sort(([a], [b]) => b - a)\n\n    // For consistent sizes as the data is static anyway\n    const commentsExtent = [0, 161]\n    const scoreExtent = [0, 271]\n\n    const verticalScale = scaleLinear()\n        .domain(scoreExtent)\n        .range([0, containerSize ? containerSize.height : 600])\n\n    const sizeScale = scaleLinear()\n        .domain(commentsExtent)\n        .range([18, 60])\n\n    return (\n        <div className={styles.storyline}>\n            <div className={styles.timeline}>\n                {days.map(([date]) => {\n                    return (\n                        <div\n                            className={styles.timelineTick}\n                            key={date.toString()}\n                        >\n                            <div className={styles.timelineYear}>\n                                {format(date, \"y\")}\n                            </div>\n                            <div>{format(date, \"MMM\")}</div>\n                            <div>{format(date, \"dd\")}</div>\n                        </div>\n                    )\n                })}\n            </div>\n\n            <div className={styles.columns} ref={containerRef}>\n                {days.map(([date, posts]) => (\n                    <div key={date.toString()} className={styles.column}>\n                        {posts\n                            .filter(p => p.age && p.fromGender)\n                            .map(p => {\n                                const postCn =\n                                    tooltip && p.url === tooltip.url\n                                        ? \" \" + styles.selected\n                                        : \"\"\n\n                                return (\n                                    <div\n                                        key={p.url}\n                                        tabIndex={0}\n                                        className={styles.post + postCn}\n                                        style={{\n                                            top: verticalScale(p.score),\n                                            fontSize: sizeScale(p.comments),\n                                        }}\n                                        onFocus={e => {\n                                            const r = e.target.getBoundingClientRect()\n                                            setTooltip({\n                                                top: r.top,\n                                                left:\n                                                    document.documentElement\n                                                        .scrollLeft +\n                                                    r.left +\n                                                    r.width / 2 +\n                                                    40,\n                                                ...p,\n                                            })\n                                        }}\n                                    >\n                                        {getEmoji(\n                                            p.age as number, // handled by filter\n                                            p.fromGender as Gender,\n                                        )}\n                                    </div>\n                                )\n                            })}\n                    </div>\n                ))}\n            </div>\n\n            {tooltip && <Tooltip {...tooltip} />}\n        </div>\n    )\n})\n","import React from \"react\"\nimport axios from \"axios\"\nimport { Post, ServerPost, serverPostToClient, filterGood } from \"./shape\"\nimport { Storyline } from \"./StoryLine\"\nimport styles from \"./App.module.css\"\nimport stylesSpinner from \"./Spinner.module.css\"\n\nconst updateMilestones = [1000, 5000, 10000, 25742]\n\nconst fileNames = Array(64)\n    .fill(0)\n    .map((_, i) => `./data/out${i}.json`)\n\nfunction App() {\n    const [buffer, setBuffer] = React.useState<Post[]>([])\n    const [posts, setPosts] = React.useState<Post[]>([])\n\n    React.useEffect(() => {\n        if (!fileNames.length) return\n        const fileName = fileNames.pop() as string\n        axios.get<any, { data: ServerPost[] }>(fileName).then(result => {\n            const newPosts = result.data\n                .map(serverPostToClient)\n                .filter(filterGood)\n\n            setBuffer([...buffer, ...newPosts])\n        })\n    }, [buffer])\n\n    React.useEffect(() => {\n        if (!updateMilestones.length || updateMilestones[0] <= buffer.length) {\n            setPosts(buffer)\n            updateMilestones.shift()\n        }\n    }, [buffer])\n\n    return (\n        <main className={styles.app}>\n            {posts.length > 0 && <Storyline posts={posts} />}\n\n            {updateMilestones.length > 0 ? (\n                <>\n                    <div className={styles.loading}>\n                        {\" \"}\n                        Loading... ({updateMilestones.length} left){\" \"}\n                    </div>\n                    <div className={stylesSpinner.heart}>\n                        <div></div>\n                    </div>\n                </>\n            ) : (\n                <p className={styles.info}>\n                    Get the full{\" \"}\n                    <a\n                        href=\"https://drive.google.com/open?id=1kLG9ls3zHLFy4HSKRlNdw23r-KJTiA-1\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                    >\n                        dataset\n                    </a>\n                </p>\n            )}\n        </main>\n    )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport App from \"./App\"\nimport * as serviceWorker from \"./serviceWorker\"\nimport \"./index.css\"\n\nReactDOM.render(<App />, document.getElementById(\"root\"))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"App_app__1kX79\",\"info\":\"App_info__3tKmE\",\"loading\":\"App_loading__wCN4P\"};"],"sourceRoot":""}